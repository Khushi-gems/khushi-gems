
{
  "entities": {
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a jewelry product in the Khushi Jewels e-commerce store.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the product."
        },
        "name": {
          "type": "string",
          "description": "Name of the product."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the product."
        },
        "price": {
          "type": "number",
          "description": "Price of the product."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the product image.",
          "format": "uri"
        },
        "category": {
          "type": "string",
          "description": "Category of the product (e.g., Necklace, Earrings)."
        },
        "material": {
          "type": "string",
          "description": "Material of the product (e.g., Gold, Silver)."
        },
        "isReadyToShip": {
          "type": "boolean",
          "description": "Indicates if the product is ready to ship immediately."
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "price",
        "imageUrl",
        "category",
        "material",
        "isReadyToShip"
      ]
    },
    "Order": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Order",
      "type": "object",
      "description": "Represents a customer order in the Khushi Jewels e-commerce store.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who placed the order. (Relationship: User 1:N Order)"
        },
        "orderDate": {
          "type": "string",
          "description": "Date and time when the order was placed.",
          "format": "date-time"
        },
        "totalAmount": {
          "type": "number",
          "description": "Total amount of the order."
        },
        "shippingAddress": {
          "type": "string",
          "description": "Shipping address for the order."
        },
        "billingAddress": {
          "type": "string",
          "description": "Billing address for the order."
        },
        "paymentMethod": {
          "type": "string",
          "description": "Payment method used for the order (e.g., Credit Card, COD)."
        },
        "orderStatus": {
          "type": "string",
          "description": "Current status of the order (e.g., Pending, Shipped, Delivered)."
        }
      },
      "required": [
        "id",
        "userId",
        "orderDate",
        "totalAmount",
        "shippingAddress",
        "billingAddress",
        "paymentMethod",
        "orderStatus"
      ]
    },
    "OrderItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "OrderItem",
      "type": "object",
      "description": "Represents an item within an order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order item."
        },
        "orderId": {
          "type": "string",
          "description": "Reference to the Order this item belongs to. (Relationship: Order 1:N OrderItem)"
        },
        "productId": {
          "type": "string",
          "description": "Reference to the Product being ordered. (Relationship: Product 1:N OrderItem)"
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of the product ordered."
        },
        "itemPrice": {
          "type": "number",
          "description": "Price of the item at the time of order."
        }
      },
      "required": [
        "id",
        "orderId",
        "productId",
        "quantity",
        "itemPrice"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the Khushi Jewels e-commerce store.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "firstName": {
          "type": "string",
          "description": "First name of the user."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the user."
        },
        "shippingAddresses": {
          "type": "array",
          "description": "Shipping addresses associated with the user.",
          "items": {
            "type": "string"
          }
        },
        "billingAddresses": {
          "type": "array",
          "description": "Billing addresses associated with the user.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "email"
      ]
    },
    "Category": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Category",
      "type": "object",
      "description": "Represents a product category.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the category."
        },
        "name": {
          "type": "string",
          "description": "Name of the category."
        },
        "description": {
          "type": "string",
          "description": "Description of the category."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL for the category image",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "imageUrl"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "phone",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Stores product information. Publicly readable, write access restricted to admins.",
          "params": [
            {
              "name": "productId",
              "description": "Unique identifier for the product."
            }
          ]
        }
      },
      {
        "path": "/categories/{categoryId}",
        "definition": {
          "entityName": "Category",
          "schema": {
            "$ref": "#/backend/entities/Category"
          },
          "description": "Stores product categories. Publicly readable, write access restricted to admins.",
          "params": [
            {
              "name": "categoryId",
              "description": "Unique identifier for the category."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Accessible only by the user and admins.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/orders/{orderId}",
        "definition": {
          "entityName": "Order",
          "schema": {
            "$ref": "#/backend/entities/Order"
          },
          "description": "Stores order information for a specific user. Accessible only by the user and admins.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "orderId",
              "description": "Unique identifier for the order."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/orders/{orderId}/orderItems/{orderItemId}",
        "definition": {
          "entityName": "OrderItem",
          "schema": {
            "$ref": "#/backend/entities/OrderItem"
          },
          "description": "Stores items within an order for a specific user. Accessible only by the user and admins.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "orderId",
              "description": "Unique identifier for the order."
            },
            {
              "name": "orderItemId",
              "description": "Unique identifier for the order item."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/wishlist/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Stores a user's wishlist items. Accessible only by the user.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "productId",
              "description": "Unique identifier for the product in the wishlist."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support Khushi Jewels' e-commerce functionality, focusing on products, orders, user data, and categories. The structure adheres to the principles of Authorization Independence by avoiding `get()` calls in security rules, enabling secure list operations, and ensuring data integrity.\n\n**Authorization Independence and Data Integrity:**\n\n*   **Orders:** Orders are stored under `/users/{userId}/orders/{orderId}`, ensuring that only the user who created the order or an admin can access it. Since order access depends on user ownership, no denormalization is needed. OrderItems, nested under orders, inherit this authorization.\n\n**Structural Segregation:**\n\n*   Products and Categories are stored in root-level collections (`/products`, `/categories`), assuming they have a global scope with potential public read access and restricted write access (e.g., only admins can modify them). If the product catalog needs to be further segmented, subcollections can be created to store products according to the user that created them.\n\n**Access Modeling:**\n\n*   User data is stored under `/users/{userId}`, following the path-based ownership model. Orders and OrderItems inherit this ownership through nested paths (`/users/{userId}/orders/{orderId}/orderItems/{orderItemId}`).\n\n**QAPs (Rules Are Not Filters):**\n\n*   The structure supports secure `list` operations by ensuring that data with different access requirements is stored in separate collections. For example, public products are stored in `/products`, while user-specific orders are stored under `/users/{userId}/orders`. This segregation allows for simple and robust security rules that do not rely on filtering data based on user roles or permissions.\n\n**Summary:** This design ensures a secure, scalable, and easily debuggable Firestore structure for the Khushi Jewels e-commerce store."
  }
}
